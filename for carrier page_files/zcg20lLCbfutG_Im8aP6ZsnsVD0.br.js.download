var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Multimedia;(function(n){var t;(function(t){var u=n.Utils.sf,r=n.InstrumentationUtils.cpl,i=ImageDetailReducers,f=function(n){function t(t){var f=this,e,o;f=n.call(this,t)||this;f.PEREGRINE_WIDGET_GROUP_ID="widgetGroup-testpage";f.PEREGRINE_WIDGET_GROUP_CLASSNAME="peregrine-widgetgroup";f.PEREGRINE_WIDGET_ID="social-comment";f.PEREGRINE_WIDGET_CLASSNAME="peregrine-widgets";f.onMSALTokenFetchLoadedEventName="onMSALTokenFetchLoaded";f.config=i.gcmtc();f.widgetModuleInit=function(){var t,i,r,n=(t=f.config)===null||t===void 0?void 0:t.wleml;((i=f.config)===null||i===void 0?void 0:i.ebdltkn)?(f.props.widgetModule.startWidgetInitializer(),n&&typeof MsalAuthenticationDelay!="undefined"&&MsalAuthenticationDelay.init(n)):n&&typeof MsalAuthenticationV2!="undefined"?MsalAuthenticationV2.init(f.props.widgetModule,n):f.props.widgetModule.startWidgetInitializer();((r=f.config)===null||r===void 0?void 0:r.eiatfl)&&(sj_evt===null||sj_evt===void 0?void 0:sj_evt.unbind(f.onMSALTokenFetchLoadedEventName,f.widgetModuleInit))};f.handlePeregrineWidgetEvent=function(n){var u,e,t,o,s,i;(n||n.detail)&&(t=n.detail,t===null||t===void 0?void 0:t.payload)&&(o=t.payload.name,o==="MS.News.Web.PageView"&&(i=r(null,null,"CI.Show","CommentShow",null,""),f.props.addToLogQueue(i)),o==="MS.News.Web.PageAction"&&((u=t.payload.data)===null||u===void 0?void 0:u.actionType)==="click"&&(s=(e=t.payload.data.object)===null||e===void 0?void 0:e.name,i={},s==="SignIn"&&(i=r(null,null,"CI.Click","CommentSignIn",null,"")),s==="Post"&&(i=r(null,null,"CI.Click","CommentPost",null,"")),f.props.addToLogQueue(i)))};f.getContentUrl=function(n){var t;return u((t=f.config)===null||t===void 0?void 0:t.cufmt,n.id,n.ck,"idp","image")};var h=i.gpc().market,s=((e=f.config)===null||e===void 0?void 0:e.osocid)||"BingImage",c=(o=f.config)===null||o===void 0?void 0:o.osapikey;return f.widgetGroupDateAttribute={appType:"sharedWidgets",pageType:"widget",cm:h,pcsAdditionalQsp:"",propertyBag:{hostSite:"bing",social:{ocid:s,apiKey:c,source:s}}},f.widgetRef=React.createRef(),f}return __extends(t,n),t.prototype.componentDidMount=function(){var n;((n=this.config)===null||n===void 0?void 0:n.eiatfl)?sj_evt===null||sj_evt===void 0?void 0:sj_evt.bind(this.onMSALTokenFetchLoadedEventName,this.widgetModuleInit):this.widgetModuleInit();this.widgetRef.current&&this.widgetRef.current.addEventListener("PeregrineWidgetEvent",this.handlePeregrineWidgetEvent)},t.prototype.componentDidUpdate=function(n){var t,r,i;this.props.imageInfo&&this.props.imageInfo.id!==n.imageInfo.id&&(r=((t=this.config)===null||t===void 0?void 0:t.ctidpref)?"".concat(this.config.ctidpref).concat(this.props.imageInfo.id):this.props.imageInfo.id,i=document.createEvent("CustomEvent"),i.initCustomEvent("widgetHost.updateSocialComment",!0,!0,{id:r,contentUrl:this.getContentUrl(this.props.imageInfo)}),_w.dispatchEvent(i))},t.prototype.componentWillUnmount=function(){this.widgetRef.current&&this.widgetRef.current.removeEventListener("PeregrineWidgetEvent",this.handlePeregrineWidgetEvent)},t.prototype.render=function(){var n,t,i,f=this.props.imageInfo.id,e=((n=this.config)===null||n===void 0?void 0:n.ctidpref)?"".concat(this.config.ctidpref).concat(f):f,o=this.getContentUrl(this.props.imageInfo),r=(t=_w===null||_w===void 0?void 0:_w.location)===null||t===void 0?void 0:t.href,s=r?u(this.config.siurfmt,encodeURIComponent(r),encodeURIComponent(r)):null,h={widgetGroup:"widgetGroup-sharedWidgets",experienceName:"SocialComment",configRef:"SocialComment/default",properties:{context:{contentId:e,id:e,contentUrl:o,widgetHostSignInUrl:s,commentDisplayType:((i=this.config)===null||i===void 0?void 0:i.shinov)?"overlay":"default"}}};return React.createElement("div",{className:"social-comment-root",ref:this.widgetRef},React.createElement("div",{id:this.PEREGRINE_WIDGET_GROUP_ID,className:this.PEREGRINE_WIDGET_GROUP_CLASSNAME,"data-widget":JSON.stringify(this.widgetGroupDateAttribute)}),React.createElement("div",{id:this.PEREGRINE_WIDGET_ID,className:this.PEREGRINE_WIDGET_CLASSNAME,"data-widget":JSON.stringify(h)}),React.createElement("div",{className:"peregrine-widgets","data-widget":'{"widgetGroup":"widgetGroup-sharedWidgets", "experienceName":"Social", "configRef":"Social/default","properties": { "context": { }}}'}))},t}(React.Component),e=function(n){var t=i.getSelectedIndex(n),r=i.getResultAtIndex(n,t),u=i.getInsightsId(n);return{imageInfo:r,insightsId:u}},o=function(n){return{addToLogQueue:function(t){n(ImageDetailActions.addToEventQueue(t))}}},s=ReactRedux.connect(e,o);t.SocialCommentWidget=s(f)})(t=n.ImageDetail||(n.ImageDetail={}))})(Multimedia||(Multimedia={}))